<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Home - UHP Bayanihan</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<style>
/* Header Navigation */
.header {
    background: rgba(0, 0, 0, 0.3);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 1000;
    padding: 1rem 0;
}

.header .container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.header .logo {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 1.5rem;
    font-weight: 700;
    color: #FFD700;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
}

.header .logo i {
    font-size: 2rem;
    color: #FFD700;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
}

.nav {
    display: flex;
    gap: 2rem;
}

.nav a {
    color: #FFD700;
    text-decoration: none;
    font-weight: 500;
    transition: color 0.3s ease;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
}

.nav a:hover {
    color: #ffff00;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7);
}

body {
    padding-top: 80px;
    background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #667eea 100%);
    min-height: 100vh;
}
</style>
</head>
<body class="bg-gray-100 font-sans text-gray-800" style="font-family: 'Montserrat', sans-serif;">

<!-- Header -->
<header class="header">
    <div class="container">
        <div class="logo">
            <i class="fas fa-wifi"></i>
            <span>UHP Bayanihan</span>
        </div>
        <nav class="nav">
            <a href="index.html">Home</a>
            <a href="uhp-ecosystem.html">UHP Ecosystem</a>
            <a href="marketing.html">Marketing</a>
            <a href="wifi-sharer.html">WiFi Sharer</a>
            <a href="antenna-sponsor.html">Antenna Sponsor</a>
            <a href="business-card.html">Contact Us</a>
        </nav>
    </div>
</header>

<script>
  tailwind.config = {
    theme: {
      extend: {
        colors: {
          primary: '#1e40af',
          secondary: '#0ea5e9',
          accent: '#fbbf24',
        }
      }
    }
  }
</script>

<!-- Hero Section -->
<section class="py-20 text-center text-white">
    <div class="container mx-auto px-6">
        <h1 class="text-5xl font-bold mb-6">üåê UHP Bayanihan</h1>
        <p class="text-xl mb-8">Connecting Communities Through Technology</p>
        
        <!-- Page Purpose Alert -->
        <div class="bg-yellow-500 bg-opacity-20 border border-yellow-300 rounded-lg p-4 mb-8 max-w-4xl mx-auto">
            <div class="flex items-center justify-center mb-2">
                <i class="fas fa-info-circle text-yellow-300 mr-2"></i>
                <h3 class="text-lg font-semibold text-yellow-100">üìç Barangay Deployment Planning</h3>
            </div>
            <p class="text-yellow-100 text-sm">
                Ang page na ito ay para sa <strong>planning at deployment tracking</strong> ng mga barangay na sasali sa UHP program.
                Para sa <strong>financial management</strong> (sales, e-wallet, commissions), pumunta sa 
                <a href="uhp-ecosystem.html" class="text-yellow-200 underline font-semibold">UHP Ecosystem</a> page.
            </p>
        </div>
    </div>
    <h1 class="text-5xl font-bold text-white mb-6">Welcome to UHP Bayanihan</h1>
    <p class="text-xl text-white/90 mb-8 max-w-3xl mx-auto">Sama-samang Pag-unlad sa Digital na Panahon - Building a connected community through shared internet access and collaborative growth.</p>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 max-w-4xl mx-auto mt-12">
      <!-- UHP Ecosystem Card -->
      <div class="bg-white/10 backdrop-blur-md p-6 rounded-lg border border-white/20 hover:bg-white/20 transition-all">
        <div class="text-4xl mb-4">üåê</div>
        <h3 class="text-xl font-bold text-white mb-3">UHP Ecosystem</h3>
        <p class="text-white/80 mb-4">Access the complete dashboard and management system</p>
        <a href="uhp-ecosystem.html" class="inline-block bg-accent text-primary font-bold px-6 py-2 rounded-full hover:bg-accent/80 transition-all">
          View Dashboard
        </a>
      </div>
      
      <!-- WiFi Sharer Card -->
      <div class="bg-white/10 backdrop-blur-md p-6 rounded-lg border border-white/20 hover:bg-white/20 transition-all">
        <div class="text-4xl mb-4">üì∂</div>
        <h3 class="text-xl font-bold text-white mb-3">WiFi Sharer</h3>
        <p class="text-white/80 mb-4">Learn about our WiFi sharing program and benefits</p>
        <a href="wifi-sharer.html" class="inline-block bg-accent text-primary font-bold px-6 py-2 rounded-full hover:bg-accent/80 transition-all">
          Learn More
        </a>
      </div>
      
      <!-- Marketing Card -->
      <div class="bg-white/10 backdrop-blur-md p-6 rounded-lg border border-white/20 hover:bg-white/20 transition-all">
        <div class="text-4xl mb-4">üìà</div>
        <h3 class="text-xl font-bold text-white mb-3">Marketing</h3>
        <p class="text-white/80 mb-4">Explore our marketing tools and income calculator</p>
        <a href="marketing.html" class="inline-block bg-accent text-primary font-bold px-6 py-2 rounded-full hover:bg-accent/80 transition-all">
          Get Started
        </a>
      </div>
    </div>
  </div>
</section>

<!-- About Section -->
<section class="py-16 px-4 bg-white/10 backdrop-blur-md">
  <div class="container mx-auto text-center">
    <h2 class="text-4xl font-bold text-white mb-8">Ano ang UHP Bayanihan?</h2>
    <div class="max-w-4xl mx-auto">
      <p class="text-xl text-white/90 mb-8">
        UHP Bayanihan ay isang community-based internet sharing platform na naglalayong magbigay ng affordable internet access sa mga Pilipino habang nagbibigay ng income opportunities sa mga miyembro ng komunidad.
      </p>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <div class="text-center">
          <div class="text-3xl mb-3">ü§ù</div>
          <h3 class="font-bold text-white mb-2">Community First</h3>
          <p class="text-white/80 text-sm">Pagkakaisa at bayanihan spirit</p>
        </div>
        <div class="text-center">
          <div class="text-3xl mb-3">üí∞</div>
          <h3 class="font-bold text-white mb-2">Income Generation</h3>
          <p class="text-white/80 text-sm">Passive income opportunities</p>
        </div>
        <div class="text-center">
          <div class="text-3xl mb-3">üåê</div>
          <h3 class="font-bold text-white mb-2">Digital Inclusion</h3>
          <p class="text-white/80 text-sm">Internet access para sa lahat</p>
        </div>
        <div class="text-center">
          <div class="text-3xl mb-3">üìà</div>
          <h3 class="font-bold text-white mb-2">Sustainable Growth</h3>
          <p class="text-white/80 text-sm">Long-term community development</p>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Dashboard -->
<section id="dashboard" class="p-8 bg-white">
  <div class="flex justify-between items-center mb-6">
    <h2 class="text-2xl font-bold text-primary">Dashboard Overview</h2>
  </div>
  
  <!-- Centered Barangay Deployment Overview -->
  <div class="max-w-4xl mx-auto mb-8">
    <!-- Barangay Deployment Overview Cards -->
    <div>
      <h3 class="text-lg font-semibold text-gray-800 mb-4 text-center">üèòÔ∏è Barangay Deployment Overview</h3>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
          <div class="bg-blue-100 p-8 rounded-lg shadow-lg border-l-4 border-primary hover:shadow-xl transition-shadow text-center h-48 w-full flex flex-col justify-center">
            <h3 class="font-bold text-lg text-gray-700 mb-3">üèòÔ∏è Total Barangays</h3>
            <p class="text-4xl font-bold text-primary mt-2 mb-2" id="totalBarangays">0</p>
            <p class="text-sm text-gray-600">Registered barangays</p>
          </div>
          <div class="bg-green-100 p-8 rounded-lg shadow-lg border-l-4 border-green-500 hover:shadow-xl transition-shadow text-center h-48 w-full flex flex-col justify-center">
            <h3 class="font-bold text-lg text-gray-700 mb-3">üì∂ Target WiFi Sharers</h3>
            <p class="text-4xl font-bold text-green-500 mt-2 mb-2" id="totalTargetWifi">0</p>
            <p class="text-sm text-gray-600">Across all barangays</p>
          </div>
          <div class="bg-purple-100 p-8 rounded-lg shadow-lg border-l-4 border-purple-500 hover:shadow-xl transition-shadow text-center h-48 w-full flex flex-col justify-center">
            <h3 class="font-bold text-lg text-gray-700 mb-3">üì° Target Antenna Sponsors</h3>
            <p class="text-4xl font-bold text-purple-500 mt-2 mb-2" id="totalTargetAntenna">0</p>
            <p class="text-sm text-gray-600">Across all barangays</p>
          </div>
          <div class="bg-orange-100 p-8 rounded-lg shadow-lg border-l-4 border-orange-500 hover:shadow-xl transition-shadow text-center h-48 w-full flex flex-col justify-center">
            <h3 class="font-bold text-lg text-gray-700 mb-3">üë• Target Population</h3>
            <p class="text-4xl font-bold text-orange-500 mt-2 mb-2" id="totalTargetPopulation">0</p>
            <p class="text-sm text-gray-600">Total population coverage</p>
          </div>
        </div>
      </div>
    </div>
  </div>

</section>

<!-- Hidden file input for import functionality -->
<input type="file" id="excelFileInput" accept=".xlsx,.xls" class="hidden" onchange="importExcelData(event)">

<!-- Password Modal -->
<div id="passwordModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
  <div class="bg-white p-6 rounded-lg shadow-xl max-w-md w-full mx-4">
    <h3 class="text-lg font-bold mb-4">Admin Authentication Required</h3>
    <p class="text-gray-600 mb-4">Enter admin password to continue:</p>
    <input type="password" id="passwordInput" placeholder="Enter password" class="w-full border rounded px-3 py-2 mb-4 focus:outline-none focus:ring-2 focus:ring-blue-500">
    <div class="flex gap-2 justify-end">
      <button type="button" onclick="closePasswordModal()" class="px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400">Cancel</button>
      <button type="button" onclick="submitPassword()" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">Submit</button>
    </div>
  </div>
</div>

<!-- Clear Data Confirmation Modal -->
<div id="clearConfirmModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
  <div class="bg-white p-6 rounded-lg shadow-xl max-w-md w-full mx-4">
    <h3 class="text-lg font-bold mb-4 text-red-600">‚ö†Ô∏è Confirm Data Deletion</h3>
    <p class="text-gray-600 mb-4">Type <strong>"DELETE BARANGAY"</strong> to confirm deletion of all barangay data:</p>
    <input type="text" id="confirmInput" placeholder="Type DELETE BARANGAY" class="w-full border rounded px-3 py-2 mb-4 focus:outline-none focus:ring-2 focus:ring-red-500">
    <div class="flex gap-2 justify-end">
      <button type="button" onclick="closeClearConfirmModal()" class="px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400">Cancel</button>
      <button type="button" onclick="submitClearConfirmation()" class="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600">Delete Data</button>
    </div>
  </div>
</div>

<!-- Barangay Deployment Section -->
<section id="barangay" class="p-8 bg-white">
  <div class="flex justify-between items-center mb-6">
    <h2 class="text-2xl font-bold">üèòÔ∏è Barangay Deployment</h2>
  </div>
  
  <!-- Admin Login Section for Barangay Data Management -->
  <div id="barangayAdminLoginSection" class="bg-white p-4 rounded shadow space-y-4 border-2 border-red-200 mb-6">
    <div class="text-center">
      <h4 class="text-sm font-semibold text-red-600 mb-2">üîí Admin Access Required</h4>
      <p class="text-xs text-gray-600 mb-4">Enter admin password to access data management functions</p>
    </div>
    <div>
      <label class="block mb-1 font-semibold text-sm">Admin Password</label>
      <input type="password" id="barangayAdminPassword" placeholder="Enter admin password" class="w-full border rounded px-3 py-2 text-sm" required>
    </div>
    <button onclick="checkBarangayAdminPassword()" class="w-full bg-red-600 text-white py-2 rounded hover:bg-red-700 text-sm font-semibold">üîì Login as Admin</button>
  </div>

  <!-- Admin Data Management Section (Hidden by default) -->
  <div id="barangayDataManagementSection" class="bg-white p-4 rounded shadow space-y-4 border-2 border-green-200 mb-6" style="display: none;">
    <div class="text-center">
      <h4 class="text-sm font-semibold text-green-600 mb-2">‚úÖ Admin Access Granted</h4>
      <button onclick="logoutBarangayAdmin()" class="text-xs text-red-600 hover:underline mb-4">üö™ Logout</button>
    </div>
    <div class="flex gap-2 justify-center">
      <button onclick="exportBarangayData()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 shadow-md transition-all transform hover:scale-105 font-bold text-sm flex items-center justify-center">
        <i class="fas fa-download mr-2"></i>
        Export Data
      </button>
      <button onclick="document.getElementById('excelFileInput').click()" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 shadow-md transition-all transform hover:scale-105 font-bold text-sm flex items-center justify-center">
        <i class="fas fa-upload mr-2"></i>
        Import Data
      </button>
      <button onclick="showClearConfirmModal()" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 shadow-md transition-all transform hover:scale-105 font-bold text-sm flex items-center justify-center">
        <i class="fas fa-trash mr-2"></i>
        Clear All Data
      </button>
    </div>
  </div>
  
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
    <!-- Barangay Registration Form -->
    <div class="bg-white p-6 rounded-lg shadow-lg border">
      <h3 class="text-lg font-semibold text-gray-800 mb-4">üìù Register New Barangay</h3>
      <form id="barangayForm" class="space-y-4">
        <!-- Address Dropdown System -->
        <div class="space-y-3">
          <label class="block mb-1 font-semibold text-sm">üìç Complete Address</label>
          
          <!-- Region -->
          <div>
            <label class="block mb-1 text-xs text-gray-600">Region</label>
            <select id="barangayRegion" class="w-full border rounded px-3 py-2 text-sm" required onchange="populateBarangayProvinces()">
              <option value="">-- Select Region --</option>
            </select>
          </div>
          
          <!-- Province -->
          <div>
            <label class="block mb-1 text-xs text-gray-600">Province</label>
            <select id="barangayProvince" class="w-full border rounded px-3 py-2 text-sm" required onchange="populateBarangayCities()" disabled>
              <option value="">-- Select Province --</option>
            </select>
          </div>
          
          <!-- City/Municipality -->
          <div>
            <label class="block mb-1 text-xs text-gray-600">City/Municipality</label>
            <select id="barangayMunicipality" class="w-full border rounded px-3 py-2 text-sm" required onchange="populateBarangayNames()" disabled>
              <option value="">-- Select City/Municipality --</option>
            </select>
          </div>
          
          <!-- Barangay -->
          <div>
            <label class="block mb-1 text-xs text-gray-600">Barangay Name</label>
            <select id="barangayName" class="w-full border rounded px-3 py-2 text-sm" required disabled>
              <option value="">-- Select Barangay --</option>
            </select>
          </div>
        </div>
        <div>
          <label class="block mb-1 font-semibold text-sm">Population</label>
          <input type="number" id="barangayPopulation" placeholder="Enter estimated population" class="w-full border rounded px-3 py-2 text-sm" required>
        </div>
        <div>
          <label class="block mb-1 font-semibold text-sm">Target WiFi Sharers</label>
          <input type="number" id="barangayTargetWifi" placeholder="Enter target number of WiFi sharers" class="w-full border rounded px-3 py-2 text-sm" required>
        </div>
        <div>
          <label class="block mb-1 font-semibold text-sm">Target Antenna Sponsors</label>
          <input type="number" id="barangayTargetAntenna" placeholder="Enter target number of antenna sponsors" class="w-full border rounded px-3 py-2 text-sm" required>
        </div>
        <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700 text-sm font-semibold">Register Barangay</button>
      </form>
    </div>

    <!-- Barangay Statistics -->
    <div class="bg-white p-6 rounded-lg shadow-lg border">
      <h3 class="text-lg font-semibold text-gray-800 mb-4">üìä Deployment Statistics</h3>
      <div class="space-y-4">
        <div class="bg-blue-100 p-4 rounded-lg">
          <h4 class="font-bold text-blue-800">Total Barangays</h4>
          <p class="text-2xl font-bold text-blue-600" id="barangayTotalBarangays">0</p>
        </div>
        <div class="bg-green-100 p-4 rounded-lg">
          <h4 class="font-bold text-green-800">Total Target WiFi Sharers</h4>
          <p class="text-2xl font-bold text-green-600" id="barangayTotalTargetWifi">0</p>
        </div>
        <div class="bg-purple-100 p-4 rounded-lg">
          <h4 class="font-bold text-purple-800">Total Target Antenna Sponsors</h4>
          <p class="text-2xl font-bold text-purple-600" id="barangayTotalTargetAntenna">0</p>
        </div>
        <div class="bg-gray-100 p-4 rounded-lg">
          <h4 class="font-bold text-gray-800">Total Target Population</h4>
          <p class="text-2xl font-bold text-gray-600" id="barangayTotalTargetPopulation">0</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Barangay List -->
  <div class="mt-8">
    <h3 class="text-xl font-bold mb-4">üèòÔ∏è Registered Barangays</h3>
    <div class="overflow-x-auto">
      <table class="min-w-full bg-white rounded shadow">
        <thead class="bg-gray-200">
          <tr>
            <th class="p-2 text-left">Barangay ID</th>
            <th class="p-2 text-left">Barangay Name</th>
            <th class="p-2 text-left">Municipality/City</th>
            <th class="p-2 text-left">Province</th>
            <th class="p-2 text-left">Population</th>
            <th class="p-2 text-left">Target WiFi</th>
            <th class="p-2 text-left">Target Antenna</th>
            <th class="p-2 text-left">Registration Date</th>
          </tr>
        </thead>
        <tbody id="barangayTable"></tbody>
      </table>
    </div>
  </div>
</section>

<script>
// Philippine Address Data Structure
const philippineAddressData = {
    "Region IV-A (CALABARZON)": {
        "Laguna": {
            "Santa Rosa": [
                "Aplaya", "Balibago", "Caingin", "Dila", "Dita", "Don Jose", 
                "Ibaba", "Kanluran", "Labas", "Macabling", "Malitlit", "Malusak", 
                "Market Area", "Pooc", "Pulong Santa Cruz", "Santo Domingo", 
                "Sinalhan", "Tagapo", "Barangay XVIII (Poblacion)"
            ],
            "Bi√±an": [
                "Bi√±an", "Bungahan", "Canlalay", "Casile", "De La Paz", "Ganado",
                "Langkiwa", "Loma", "Malaban", "Malamig", "Mamplasan", "Platero",
                "Poblacion", "San Antonio", "San Francisco", "San Jose", "San Vicente",
                "Santo Domingo", "Santo Ni√±o", "Santo Tomas", "Soro-soro", "Timbao",
                "Tubigan", "Zapote"
            ],
            "Calamba": [
                "Bagong Kalsada", "Banadero", "Banlic", "Barandal", "Batino", "Bubuyan",
                "Bucal", "Bunggo", "Burol", "Camaligan", "Canlubang", "Halang", "Hornalan",
                "Kay-Anlog", "La Mesa", "Laguerta", "Lawa", "Lecheria", "Lingga", "Looc",
                "Mabato", "Majada-Labas", "Makiling", "Mapagong", "Masili", "Maunong",
                "Mayapa", "Milagrosa", "Paciano Rizal", "Palingon", "Palo-Alto", "Pansol",
                "Parian", "Poblacion", "Punta", "Puting Lupa", "Real", "Saimsim",
                "Sampiruhan", "San Cristobal", "San Jose", "San Juan", "Sirang Lupa",
                "Sucol", "Turbina", "Ulango", "Uwisan"
            ],
            "Los Ba√±os": [
                "Anos", "Bagong Silang", "Bambang", "Batong Malake", "Baybayin", "Bayog",
                "Lalakay", "Maahas", "Malinta", "Mayondon", "Poblacion", "Putho-Tuntungin",
                "San Antonio", "Tadlac", "Timugan"
            ],
            "San Pedro": [
                "Bagong Silang", "Calendola", "Chrysanthemum", "Cuyab", "Estrella",
                "G.S.I.S.", "Landayan", "Laram", "Magsaysay", "Maharlika", "Narra",
                "Nueva", "Pacita 1", "Pacita 2", "Poblacion", "Riverside", "Rosario",
                "Sampaguita", "San Antonio", "San Roque", "San Vicente", "Santo Ni√±o",
                "United Bayanihan", "United Paraiso"
            ]
        },
        "Cavite": {
            "Bacoor": [
                "Alima", "Aniban I", "Aniban II", "Aniban III", "Aniban IV", "Aniban V",
                "Banalo", "Bayanan", "Campo Santo", "Dasmari√±as", "Digman", "Dulong Bayan",
                "Habay I", "Habay II", "Kaingin", "Ligas I", "Ligas II", "Ligas III",
                "Mabolo I", "Mabolo II", "Mabolo III", "Maliksi I", "Maliksi II", "Maliksi III",
                "Molino I", "Molino II", "Molino III", "Molino IV", "Molino V", "Molino VI",
                "Molino VII", "Niog I", "Niog II", "Niog III", "Panapaan I", "Panapaan II",
                "Panapaan III", "Panapaan IV", "Panapaan V", "Panapaan VI", "Panapaan VII",
                "Panapaan VIII", "Queens Row Central", "Queens Row East", "Queens Row West",
                "Real I", "Real II", "Salinas I", "Salinas II", "Salinas III", "Salinas IV",
                "San Nicolas I", "San Nicolas II", "San Nicolas III", "Springville",
                "Tabing Dagat", "Talaba I", "Talaba II", "Talaba III", "Talaba IV",
                "Talaba V", "Talaba VI", "Talaba VII", "Zapote I", "Zapote II", "Zapote III",
                "Zapote IV", "Zapote V"
            ],
            "Dasmari√±as": [
                "Bagong Bayan", "Burol I", "Burol II", "Burol III", "Datu Esmael",
                "Fatima I", "Fatima II", "Fatima III", "Langkaan I", "Langkaan II",
                "Luzviminda I", "Luzviminda II", "Paliparan I", "Paliparan II", "Paliparan III",
                "Sabang", "Salawag", "Sampaloc I", "Sampaloc II", "Sampaloc III", "Sampaloc IV",
                "San Agustin I", "San Agustin II", "San Agustin III", "San Jose",
                "San Miguel I", "San Miguel II", "Zone I (Poblacion)", "Zone II (Poblacion)",
                "Zone III (Poblacion)", "Zone IV (Poblacion)"
            ]
        },
        "Batangas": {
            "Lipa": [
                "Adya", "Anilao", "Anilao-Labac", "Antipolo del Norte", "Antipolo del Sur",
                "Bagong Pook", "Balintawak", "Banaybanay", "Bolbok", "Bugtong na Pulo",
                "Bulacnin", "Bulaklakan", "Calamias", "Cumba", "Dagatan", "Duhatan",
                "Halang", "Inosluban", "Kayumanggi", "Latag", "Lodlod", "Lumbang",
                "Mabini", "Malagonlong", "Marawoy", "Marauoy", "Mataas na Lupa",
                "Munting Pulo", "Pagolingin Bata", "Pagolingin East", "Pagolingin West",
                "Pangao", "Pinagkawitan", "Pinagtongulan", "Plaridel", "Poblacion Barangay 1",
                "Poblacion Barangay 2", "Poblacion Barangay 3", "Poblacion Barangay 4",
                "Poblacion Barangay 5", "Poblacion Barangay 6", "Poblacion Barangay 7",
                "Poblacion Barangay 8", "Poblacion Barangay 9", "Poblacion Barangay 9-A",
                "Poblacion Barangay 10", "Poblacion Barangay 11", "Poblacion Barangay 12",
                "Pusil", "Quezon", "Rizal", "Sabang", "Sampaguita", "San Benito",
                "San Carlos", "San Celestino", "San Francisco", "San Guillermo",
                "San Jose", "San Lucas", "San Salvador", "San Sebastian", "Santo Ni√±o",
                "Santo Toribio", "Sapac", "Sico", "Talisay", "Tambo", "Tangob",
                "Tanguay", "Tibig", "Tipacan"
            ]
        },
        "Rizal": {
            "Antipolo": [
                "Bagong Nayon", "Beverly Hills", "Calawis", "Cupang", "Dalig", "dela Paz",
                "Inarawan", "Mambugan", "Mayamot", "San Isidro", "San Jose", "San Luis",
                "San Roque", "Santa Cruz", "Santo Ni√±o", "Taktak"
            ]
        },
        "Quezon": {
            "Lucena": [
                "Barangay 1 (Poblacion)", "Barangay 2 (Poblacion)", "Barangay 3 (Poblacion)", 
                "Barangay 4 (Poblacion)", "Barangay 5 (Poblacion)", "Barangay 6 (Poblacion)", 
                "Barangay 7 (Poblacion)", "Barangay 8 (Poblacion)", "Barangay 9 (Poblacion)", 
                "Barangay 10 (Poblacion)", "Barra", "Bocohan", "Cotta", "Dalahican", 
                "Domoit", "Gulang-Gulang", "Ibabang Dupay", "Ibabang Iyam", "Ibabang Talim", 
                "Ilayang Dupay", "Ilayang Iyam", "Ilayang Talim", "Isabang", "Kanlurang Mayao",
                "Kulapi", "Mayao Castillo", "Mayao Crossing", "Mayao Kanluran",
                "Mayao Parada", "Ransohan", "Salinas", "Silangang Mayao"
            ]
        }
    },
    "National Capital Region (NCR)": {
        "Metro Manila": {
            "Manila": [
                "Barangay 1 (District I)", "Barangay 2 (District I)", "Barangay 3 (District I)",
                "Barangay 4 (District I)", "Barangay 5 (District I)", "Barangay 6 (District I)",
                "Binondo", "Ermita", "Intramuros", "Malate", "Paco", "Pandacan", 
                "Port Area", "Quiapo", "Sampaloc", "San Andres", "San Miguel", 
                "San Nicolas", "Santa Ana", "Santa Cruz", "Santa Mesa", "Tondo",
                "Barangay 267 (Binondo)", "Barangay 268 (Binondo)", "Barangay 269 (Binondo)",
                "Barangay 270 (Binondo)", "Barangay 271 (Binondo)", "Barangay 272 (Binondo)",
                "Barangay 273 (Binondo)", "Barangay 274 (Binondo)", "Barangay 275 (Binondo)",
                "Barangay 276 (Binondo)", "Barangay 277 (Binondo)", "Barangay 278 (Binondo)",
                "Barangay 279 (Binondo)", "Barangay 280 (Binondo)", "Barangay 281 (Binondo)",
                "Barangay 282 (Binondo)", "Barangay 283 (Binondo)", "Barangay 284 (Binondo)",
                "Barangay 285 (Binondo)", "Barangay 286 (Binondo)", "Barangay 287 (Binondo)",
                "Barangay 288 (Binondo)", "Barangay 289 (Binondo)", "Barangay 290 (Binondo)"
            ],
            "Quezon City": [
                "Alicia", "Amihan", "Apolonio Samson", "Aurora", "Baesa", "Bagbag",
                "Bagong Lipunan ng Crame", "Bagong Pag-asa", "Bagong Silangan",
                "Balintawak", "Batasan Hills", "Bayanihan", "Blue Ridge A", "Blue Ridge B",
                "Botocan", "Bungad", "Camp Aguinaldo", "Central", "Claro", "Commonwealth",
                "Culiat", "Damar", "Damayan", "Damayang Lagi", "Del Monte", "Diliman",
                "Don Manuel", "Do√±a Imelda", "Do√±a Josefa", "Duyan-Duyan", "E. Rodriguez",
                "East Kamias", "Escopa I", "Escopa II", "Escopa III", "Escopa IV",
                "Fairview", "Greater Lagro", "Gulod", "Holy Spirit", "Horseshoe",
                "Immaculate Conception", "Kaligayahan", "Kalusugan", "Kamuning",
                "Katipunan", "Kaunlaran", "Kristong Hari", "Krus na Ligas", "Laging Handa",
                "Libis", "Lourdes", "Loyola Heights", "Maharlika", "Malaya", "Mariana",
                "Mariblo", "Marilag", "Masambong", "Matandang Balara", "Milagrosa",
                "N.S. Amoranto", "Nagkaisang Nayon", "Nayong Kanluran", "New Era",
                "North Fairview", "Novaliches Proper", "Obrero", "Old Balara", "Paang Bundok",
                "Pag-ibig sa Nayon", "Paligsahan", "Paltok", "Paraiso", "Pasong Putik Proper",
                "Pasong Tamo", "Payatas", "Phil-Am", "Pinagkaisahan", "Pinyahan",
                "Project 6", "Project 7", "Project 8", "Quirino 2-A", "Quirino 2-B",
                "Quirino 2-C", "Quirino 3-A", "Ram√≥n Magsaysay", "Roxas", "Sacred Heart",
                "Saint Ignatius", "Saint Peter", "Salvacion", "San Agustin", "San Antonio",
                "San Bartolome", "San Isidro Labrador", "San Jose", "San Martin de Porres",
                "San Roque", "San Vicente", "Sangandaan", "Santa Lucia", "Santa Monica",
                "Santa Teresita", "Santo Cristo", "Santo Domingo", "Santo Ni√±o",
                "Santol", "Sauyo", "Sienna", "Silangan", "Socorro", "South Triangle",
                "Tagumpay", "Talayan", "Tandang Sora", "Tatalon", "Teachers Village East",
                "Teachers Village West", "Ugong Norte", "Unang Sigaw", "UP Campus",
                "Valencia", "Vasra", "Veterans Village", "Villa Maria Clara",
                "West Kamias", "West Triangle", "White Plains"
            ],
            "Makati": [
                "Bangkal", "Bel-Air", "Carmona", "Cembo", "Comembo", "Dasmari√±as",
                "East Rembo", "Forbes Park", "Guadalupe Nuevo", "Guadalupe Viejo",
                "Kasilawan", "La Paz", "Magallanes", "Olympia", "Palanan", "Pembo",
                "Pinagkaisahan", "Pio del Pilar", "Pitogo", "Poblacion", "Post Proper Northside",
                "Post Proper Southside", "Rizal", "San Antonio", "San Isidro", "San Lorenzo",
                "Santa Cruz", "Singkamas", "South Cembo", "Tejeros", "Urdaneta", "Valenzuela",
                "West Rembo"
            ]
        }
    },
    "Region III (Central Luzon)": {
        "Bulacan": {
            "Malolos": [
                "Anilao", "Atlag", "Babatnin", "Bagna", "Bagong Nayon", "Balayong",
                "Balite", "Bangkal", "Barihan", "Bulihan", "Bungahan", "Caingin",
                "Calero", "Caliligawan", "Canalate", "Caniogan", "Catmon", "Cofradia",
                "Dakila", "Guinhawa", "Ligas", "Longos", "Look 1st", "Look 2nd",
                "Lugam", "Mabolo", "Mojon", "Namayan", "Niugan", "Pamarawan",
                "Panasahan", "Pinagbakahan", "San Agustin", "San Gabriel", "San Juan",
                "San Pablo", "San Vicente", "Santiago", "Santisima Trinidad", "Santo Cristo",
                "Santo Ni√±o", "Santo Rosario", "Sumapang Bata", "Sumapang Matanda",
                "Taal", "Tikay"
            ]
        },
        "Pampanga": {
            "San Fernando": [
                "Alasas", "Baliti", "Bulaon", "Calulut", "Dela Paz Norte", "Dela Paz Sur",
                "Dolores", "Juliana", "Lara", "Lourdes", "Magliman", "Maimpis",
                "Malino", "Malpitic", "Panipuan", "Panlumacan", "Pulung Bulu",
                "Quebiawan", "San Agustin", "San Felipe", "San Isidro", "San Jose",
                "San Juan", "San Nicolas", "San Pedro", "Santa Lucia", "Santa Teresita",
                "Santo Ni√±o", "Santo Rosario", "Sindalan", "Telabastagan"
            ]
        }
    }
};

// Populate regions dropdown for barangay form
function populateBarangayRegions() {
    const regionSelect = document.getElementById('barangayRegion');
    if (!regionSelect) return;
    
    regionSelect.innerHTML = '<option value="">-- Select Region --</option>';
    
    // Sort regions alphabetically
    const sortedRegions = Object.keys(philippineAddressData).sort();
    
    sortedRegions.forEach(region => {
        const option = document.createElement('option');
        option.value = region;
        option.textContent = region;
        regionSelect.appendChild(option);
    });
}

// Populate provinces based on selected region for barangay form
function populateBarangayProvinces() {
    const regionSelect = document.getElementById('barangayRegion');
    const provinceSelect = document.getElementById('barangayProvince');
    const citySelect = document.getElementById('barangayMunicipality');
    const barangaySelect = document.getElementById('barangayName');
    
    if (!regionSelect || !provinceSelect) return;
    
    const selectedRegion = regionSelect.value;
    
    // Reset dependent dropdowns
    provinceSelect.innerHTML = '<option value="">-- Select Province --</option>';
    citySelect.innerHTML = '<option value="">-- Select City/Municipality --</option>';
    barangaySelect.innerHTML = '<option value="">-- Select Barangay --</option>';
    
    // Disable dependent dropdowns
    provinceSelect.disabled = !selectedRegion;
    citySelect.disabled = true;
    barangaySelect.disabled = true;
    
    if (selectedRegion && philippineAddressData[selectedRegion]) {
        // Sort provinces alphabetically
        const sortedProvinces = Object.keys(philippineAddressData[selectedRegion]).sort();
        
        sortedProvinces.forEach(province => {
            const option = document.createElement('option');
            option.value = province;
            option.textContent = province;
            provinceSelect.appendChild(option);
        });
    }
}

// Populate cities based on selected province for barangay form
function populateBarangayCities() {
    const regionSelect = document.getElementById('barangayRegion');
    const provinceSelect = document.getElementById('barangayProvince');
    const citySelect = document.getElementById('barangayMunicipality');
    const barangaySelect = document.getElementById('barangayName');
    
    if (!regionSelect || !provinceSelect || !citySelect) return;
    
    const selectedRegion = regionSelect.value;
    const selectedProvince = provinceSelect.value;
    
    // Reset dependent dropdowns
    citySelect.innerHTML = '<option value="">-- Select City/Municipality --</option>';
    barangaySelect.innerHTML = '<option value="">-- Select Barangay --</option>';
    
    // Disable dependent dropdowns
    citySelect.disabled = !selectedProvince;
    barangaySelect.disabled = true;
    
    if (selectedRegion && selectedProvince && 
        philippineAddressData[selectedRegion] && 
        philippineAddressData[selectedRegion][selectedProvince]) {
        
        // Sort cities alphabetically
        const sortedCities = Object.keys(philippineAddressData[selectedRegion][selectedProvince]).sort();
        
        sortedCities.forEach(city => {
            const option = document.createElement('option');
            option.value = city;
            option.textContent = city;
            citySelect.appendChild(option);
        });
    }
}

// Populate barangays based on selected city for barangay form
function populateBarangayNames() {
    const regionSelect = document.getElementById('barangayRegion');
    const provinceSelect = document.getElementById('barangayProvince');
    const citySelect = document.getElementById('barangayMunicipality');
    const barangaySelect = document.getElementById('barangayName');
    
    if (!regionSelect || !provinceSelect || !citySelect || !barangaySelect) return;
    
    const selectedRegion = regionSelect.value;
    const selectedProvince = provinceSelect.value;
    const selectedCity = citySelect.value;
    
    // Reset barangay dropdown
    barangaySelect.innerHTML = '<option value="">-- Select Barangay --</option>';
    barangaySelect.disabled = !selectedCity;
    
    if (selectedRegion && selectedProvince && selectedCity &&
        philippineAddressData[selectedRegion] && 
        philippineAddressData[selectedRegion][selectedProvince] &&
        philippineAddressData[selectedRegion][selectedProvince][selectedCity]) {
        
        // Sort barangays alphabetically
        const sortedBarangays = philippineAddressData[selectedRegion][selectedProvince][selectedCity].sort();
        
        sortedBarangays.forEach(barangay => {
            const option = document.createElement('option');
            option.value = barangay;
            option.textContent = barangay;
            barangaySelect.appendChild(option);
        });
    }
}

// Global variables - Barangay deployment data only
let barangayData = JSON.parse(localStorage.getItem('barangayData')) || [];

// Admin password
const ADMIN_PASSWORD = 'admin123';
let isAdminLoggedIn = false;

// Initialize the application
document.addEventListener('DOMContentLoaded', function() {
    updateDashboard();
    updateBarangayTable();
    updateBarangayStats();
    populateBarangayRegions(); // Initialize region dropdown
});

// Registration functions removed - now handled by UHP Ecosystem page

// Sales and e-wallet functions removed - now handled by UHP Ecosystem page

// Barangay form handling
document.getElementById('barangayForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const barangay = {
        id: 'BRG' + String(barangayData.length + 1).padStart(3, '0'),
        name: document.getElementById('barangayName').value,
        municipality: document.getElementById('barangayMunicipality').value,
        province: document.getElementById('barangayProvince').value,
        population: parseInt(document.getElementById('barangayPopulation').value),
        targetWifi: parseInt(document.getElementById('barangayTargetWifi').value),
        targetAntenna: parseInt(document.getElementById('barangayTargetAntenna').value),
        registrationDate: new Date().toLocaleDateString()
    };
    
    barangayData.push(barangay);
    localStorage.setItem('barangayData', JSON.stringify(barangayData));
    
    document.getElementById('barangayForm').reset();
    updateBarangayTable();
    updateBarangayStats();
    
    alert('Barangay registered successfully!');
});

// Admin functions removed - now handled by UHP Ecosystem page

// Update functions
function updateDashboard() {
    // Dashboard now focuses on Barangay deployment statistics
    const totalBarangays = barangayData.length;
    const deployedBarangays = barangayData.filter(b => b.status === 'Deployed').length;
    const pendingBarangays = barangayData.filter(b => b.status === 'Pending').length;
    const inProgressBarangays = barangayData.filter(b => b.status === 'In Progress').length;
    
    // Update dashboard cards with Barangay deployment data
    const totalSalesElement = document.getElementById('totalSales');
    if (totalSalesElement) totalSalesElement.textContent = totalBarangays;
    
    const totalWiFiPersonalElement = document.getElementById('totalWiFiPersonal');
    if (totalWiFiPersonalElement) totalWiFiPersonalElement.textContent = deployedBarangays;
    
    const sharedPoolElement = document.getElementById('sharedPool');
    if (sharedPoolElement) sharedPoolElement.textContent = pendingBarangays;
    
    const valuePerShareElement = document.getElementById('valuePerShare');
    if (valuePerShareElement) valuePerShareElement.textContent = inProgressBarangays;
    
    // Update other elements if they exist
    const agentsShareElement = document.getElementById('agentsShare');
    if (agentsShareElement) agentsShareElement.textContent = '0';
    
    const opexShareElement = document.getElementById('opexShare');
    if (opexShareElement) opexShareElement.textContent = '0';
    
    const totalSharesElement = document.getElementById('totalShares');
    if (totalSharesElement) totalSharesElement.textContent = '0';
    
    const ewalletIncomeElement = document.getElementById('ewalletIncome');
    if (ewalletIncomeElement) ewalletIncomeElement.textContent = '0';
    
    const ewalletToWifiSharersElement = document.getElementById('ewalletToWifiSharers');
    if (ewalletToWifiSharersElement) ewalletToWifiSharersElement.textContent = '0';
}

// Financial functions removed - now handled by UHP Ecosystem page

// Registration tables function removed - now handled by UHP Ecosystem page

function updateBarangayTable() {
    const barangayTable = document.getElementById('barangayTable');
    barangayTable.innerHTML = '';
    
    barangayData.forEach(barangay => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td class="p-2 border-b">${barangay.id}</td>
            <td class="p-2 border-b">${barangay.name}</td>
            <td class="p-2 border-b">${barangay.municipality}</td>
            <td class="p-2 border-b">${barangay.province}</td>
            <td class="p-2 border-b">${barangay.population.toLocaleString()}</td>
            <td class="p-2 border-b">${barangay.targetWifi}</td>
            <td class="p-2 border-b">${barangay.targetAntenna}</td>
            <td class="p-2 border-b">${barangay.registrationDate}</td>
        `;
        barangayTable.appendChild(row);
    });
}

function updateBarangayStats() {
    try {
        const totalBarangays = barangayData.length;
        const totalTargetWifi = barangayData.reduce((sum, b) => sum + (parseInt(b.targetWifi) || 0), 0);
        const totalTargetAntenna = barangayData.reduce((sum, b) => sum + (parseInt(b.targetAntenna) || 0), 0);
        const totalTargetPopulation = barangayData.reduce((sum, b) => sum + (parseInt(b.population) || 0), 0);
        
        // Update main dashboard stats
        const totalBarangaysElement = document.getElementById('totalBarangays');
        const totalTargetWifiElement = document.getElementById('totalTargetWifi');
        const totalTargetAntennaElement = document.getElementById('totalTargetAntenna');
        const totalTargetPopulationElement = document.getElementById('totalTargetPopulation');
        
        if (totalBarangaysElement) totalBarangaysElement.textContent = totalBarangays;
        if (totalTargetWifiElement) totalTargetWifiElement.textContent = totalTargetWifi;
        if (totalTargetAntennaElement) totalTargetAntennaElement.textContent = totalTargetAntenna;
        if (totalTargetPopulationElement) totalTargetPopulationElement.textContent = totalTargetPopulation.toLocaleString();
        
        // Update barangay section stats
        const barangayTotalBarangaysElement = document.getElementById('barangayTotalBarangays');
        const barangayTotalTargetWifiElement = document.getElementById('barangayTotalTargetWifi');
        const barangayTotalTargetAntennaElement = document.getElementById('barangayTotalTargetAntenna');
        const barangayTotalTargetPopulationElement = document.getElementById('barangayTotalTargetPopulation');
        
        if (barangayTotalBarangaysElement) barangayTotalBarangaysElement.textContent = totalBarangays;
        if (barangayTotalTargetWifiElement) barangayTotalTargetWifiElement.textContent = totalTargetWifi;
        if (barangayTotalTargetAntennaElement) barangayTotalTargetAntennaElement.textContent = totalTargetAntenna;
        if (barangayTotalTargetPopulationElement) barangayTotalTargetPopulationElement.textContent = totalTargetPopulation.toLocaleString();
    } catch (error) {
        console.error('Error updating barangay stats:', error);
        // Set default values if there's an error
        const mainElements = ['totalBarangays', 'totalTargetWifi', 'totalTargetAntenna', 'totalTargetPopulation'];
        const barangayElements = ['barangayTotalBarangays', 'barangayTotalTargetWifi', 'barangayTotalTargetAntenna', 'barangayTotalTargetPopulation'];
        
        [...mainElements, ...barangayElements].forEach(id => {
            const element = document.getElementById(id);
            if (element) element.textContent = '0';
        });
    }
}

// Dropdown population functions removed - now handled by UHP Ecosystem page

// Modal-based authentication system
let currentAction = null;

function showPasswordModal(action) {
    currentAction = action;
    document.getElementById('passwordModal').classList.remove('hidden');
    document.getElementById('passwordInput').focus();
    
    // Add keyboard event listeners
    document.addEventListener('keydown', handleModalKeydown);
}

function handleModalKeydown(event) {
    if (event.key === 'Enter') {
        event.preventDefault();
        submitPassword();
    } else if (event.key === 'Escape') {
        event.preventDefault();
        closePasswordModal();
    }
}

function closePasswordModal() {
    document.getElementById('passwordModal').classList.add('hidden');
    document.getElementById('passwordInput').value = '';
    currentAction = null;
    
    // Remove keyboard event listeners
    document.removeEventListener('keydown', handleModalKeydown);
}

function submitPassword() {
    const password = document.getElementById('passwordInput').value.trim();
    
    if (password !== 'admin123') {
        alert('Incorrect password!');
        document.getElementById('passwordInput').value = '';
        document.getElementById('passwordInput').focus();
        return;
    }
    
    closePasswordModal();
    
    if (currentAction === 'export') {
        exportBarangayData();
    } else if (currentAction === 'import') {
        document.getElementById('excelFileInput').click();
    } else if (currentAction === 'clear') {
        showClearConfirmModal();
    }
}

// Clear confirmation modal functions
function showClearConfirmModal() {
    document.getElementById('clearConfirmModal').classList.remove('hidden');
    document.getElementById('confirmInput').focus();
    
    // Add keyboard event listeners for confirmation modal
    document.addEventListener('keydown', handleClearModalKeydown);
}

function handleClearModalKeydown(event) {
    if (event.key === 'Enter') {
        event.preventDefault();
        submitClearConfirmation();
    } else if (event.key === 'Escape') {
        event.preventDefault();
        closeClearConfirmModal();
    }
}

function closeClearConfirmModal() {
    document.getElementById('clearConfirmModal').classList.add('hidden');
    document.getElementById('confirmInput').value = '';
    
    // Remove keyboard event listeners
    document.removeEventListener('keydown', handleClearModalKeydown);
}

function submitClearConfirmation() {
    const confirmation = document.getElementById('confirmInput').value.trim();
    
    if (confirmation !== 'DELETE BARANGAY') {
        alert('Confirmation text does not match. Data deletion cancelled.');
        document.getElementById('confirmInput').value = '';
        document.getElementById('confirmInput').focus();
        return;
    }
    
    closeClearConfirmModal();
    
    // Clear barangay data only
    barangayData = [];
    
    // Clear localStorage
    localStorage.removeItem('barangayData');
    
    // Refresh barangay displays only
    updateBarangayTable();
    updateBarangayStats();
    updateDashboard();
    
    alert('Barangay deployment data has been cleared!');
}

// Barangay Admin Login Functions
function checkBarangayAdminPassword() {
    const password = document.getElementById('barangayAdminPassword').value;
    if (password === ADMIN_PASSWORD) {
        document.getElementById('barangayAdminLoginSection').style.display = 'none';
        document.getElementById('barangayDataManagementSection').style.display = 'block';
        document.getElementById('barangayAdminPassword').value = '';
        alert('‚úÖ Admin access granted for Barangay Data Management!');
    } else {
        alert('‚ùå Incorrect password. Access denied.');
        document.getElementById('barangayAdminPassword').value = '';
    }
}

function logoutBarangayAdmin() {
    document.getElementById('barangayAdminLoginSection').style.display = 'block';
    document.getElementById('barangayDataManagementSection').style.display = 'none';
}

// Excel export/import functions for Barangay deployment
function exportAllDataWithPassword() {
    showPasswordModal('export');
}

function exportBarangayData() {
    if (barangayData.length === 0) {
        alert('No barangay data to export!');
        return;
    }
    
    try {
        const workbook = XLSX.utils.book_new();
        const barangayWS = XLSX.utils.json_to_sheet(barangayData);
        XLSX.utils.book_append_sheet(workbook, barangayWS, 'Barangay Deployment');
        XLSX.writeFile(workbook, 'UHP_Barangay_Deployment.xlsx');
        alert('Export successful! File downloaded.');
    } catch (error) {
        alert('Export failed: ' + error.message);
    }
}

function importExcelWithPasswordPrompt() {
    showPasswordModal('import');
}

function importExcelData(event) {
    const file = event.target.files[0];
    if (!file) {
        alert('No file selected!');
        return;
    }
    
    const reader = new FileReader();
    reader.onload = function(e) {
        try {
            const data = new Uint8Array(e.target.result);
            const workbook = XLSX.read(data, {type: 'array'});
            
            // Import Barangay Deployment sheet only
            if (workbook.SheetNames.includes('Barangay Deployment')) {
                const barangaySheet = workbook.Sheets['Barangay Deployment'];
                barangayData = XLSX.utils.sheet_to_json(barangaySheet);
                localStorage.setItem('barangayData', JSON.stringify(barangayData));
                updateBarangayStats();
                updateBarangayTable();
                alert('Successfully imported ' + barangayData.length + ' barangay records!');
            } else if (workbook.SheetNames.includes('Barangay Data')) {
                // Fallback for old format
                const barangaySheet = workbook.Sheets['Barangay Data'];
                barangayData = XLSX.utils.sheet_to_json(barangaySheet);
                localStorage.setItem('barangayData', JSON.stringify(barangayData));
                updateBarangayStats();
                updateBarangayTable();
                alert('Successfully imported ' + barangayData.length + ' barangay records!');
            } else {
                alert('No valid sheet found in the Excel file! Available sheets: ' + workbook.SheetNames.join(', '));
                return;
            }
        } catch (error) {
            alert('Import failed: ' + error.message);
        }
    };
    
    reader.readAsArrayBuffer(file);
}

function clearAllDataWithPassword() {
    showPasswordModal('clear');
}
</script>

</body>
</html>
